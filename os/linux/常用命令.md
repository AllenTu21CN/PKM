* Rsync同步,详细参见[Rsync参数详解](Rsync参数详解.md)

```
rsync -avrW  --progress -e 'ssh -p 22' /home/root/tmp/main/build/linux/pkg.mp/lib root@10.2.0.77:/mnt/pkgs/mp/
rsync -avrW  --progress -e 'ssh -p 22' tyj@10.1.27.11:/home/tyj/1+N/trunk/build/linux/pkg.mp/lib /mnt/pkgs/mp/
    -a, --archive       # 归档模式，表示以递归方式传输文件，并保持所有文件属性，等于-rlptgoD
    -v, --verbose       # 详细模式输出
    -r, --recursive     # 对子目录以递归模式处理
    -W, --whole-file    # 拷贝文件，不进行增量检测
```

* grep
    * -r 如果搜索的目标中包含目录，必须有此选项，否则报错
    * -i  忽略大小写
    * 全目录的字符串查找: `find .|xargs grep -r "settings"`

* sed
    * 文件中字符串替换: `sed -i "s/<src>/<dst>/g" src_file`
    
* 文件提取

```
find . | grep \.h | cpio -cov | gzip -c -9 > ../1.gz
zcat 1.gz | cpio -iduv
```

* yum常用 

```
# -y表示不进行交互，回答yes。
yum provides */libexpat.so.0    # 查看库在那个yum包中
yum -y clean all                # 清理yum缓存
yum makecache                   # 重建yum缓存
yum list                        # 查询软件包列表
yum grouplist                   # 查询软件包组列表
yum list installed              # 查询已安装的包
yum list available              # 查询可以安装（未安装）的包
yum info                        # 查询软件包的描述信息
yum search 软件包名             # 查询指定的软件包
yum search all                  # 把所有软件包都列表出来
yum install                     # 安装软件包
yum update                      # 升级软件包
yum remove                      # 卸载软件包
yum erase                       # 卸载软件包
```

* awk
    * 获取指定名字进程的id: `ps -ef | egrep "webrtc" | grep -v "grep" | awk '{print $2}'`
    
* 抓包命令: `tcpdump  -s 0 -w catch.pcap host 10.1.100.111 and port 3230`

* 别名 `alias start=''`

* rpm
    * 查看已安装包的信息: `rpm -ql`
    
* Wget
    * `wget --http-user=allen_tu --http-passwd=tuyajie21CN`
    
* 时区设置: `cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime`

* SSH自动密码登录
    * Using sshpass util; 
    
    ```
    sshpass -p "YOUR_PASSWORD" ssh -o StrictHostKeyChecking=no "sshserver"
    sshpass -d pass.txt ssh -o StrictHostKeyChecking=no "sshserver"
    ```
    * Using expect util; add script as /usr/bin/exp with following, then command likes `exp <password> ssh <anything>`:
    
    ```
    #!/usr/bin/expect
    
    set timeout 20
    
    set cmd [lrange $argv 1 end]
    set password [lindex $argv 0]
    
    eval spawn $cmd
    expect "assword:"
    send "$password\r";
    interact
    ```
    
* SSH免密登录
    * 手动生成密钥
    
    ```
    # client生成密钥，并存至server端
    ssh-keygen
    ...
    scp ~/.ssh/xxx_id_rsa.pub <server>:~/
    
    # server端将密钥添加到认证列表中
    cat ~/xxx_id_rsa.pub >> ~/.ssh/authorized_keys
    ```
    * 或者client端使用命令:`ssh-copy-id <user>@<server>`

* Crontab

```
systemctl status/start/stop/reload/enable crond
crontab -l # 查看当前用户定时任务
crontab -e # 编解当前用户定时任务

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name  command to be executed
# [分] [时] [日] [月] [周] [需要执行的命令]

# 例: 每1分钟执行一次
*/1 * * * * do_task_cmd
```

* ethtool, 查询及设置网卡参数的命令

```
ethtool -s eth0 autoneg off speed 100 duplex full

ethtool ethX    # 查询ethX网口基本设置
ethtool -i ethX # 查询ethX网口的相关信息 
ethtool -d ethX # 查询ethX网口注册性信息
ethtool -r ethX # 重置ethX网口到自适应模式
ethtool -S ethX # 查询ethX网口收发包统计
ethtool -s ethX # 设置网口参数
    [speed 10|100|1000]     # 设置网口速率10/100/1000M
    [duplex half|full]      # 设置网口半/全双工
    [autoneg on|off]        # 设置网口是否自协商
    [port tp|aui|bnc|mii]   # 设置网口类型
    [phyad N]                 
    [xcvr internal|exteral]
    [wol p|u|m|b|a|g|s|d...]
    [sopass xx:yy:zz:aa:bb:cc]
    [msglvl N]
```

# Shell脚本任何一条命令执行错误，则退出：

```
# exit when any command fails
set -e
# keep track of the last executed command
trap 'last_command=$current_command; current_command=$BASH_COMMAND' DEBUG
# echo an error message before exiting
trap 'echo "\"${last_command}\" command filed with exit code $?."' EXIT
```
